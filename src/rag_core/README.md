# RAG Core (`rag_core`)

## 目的

Retrieval-Augmented Generation (RAG) システムのコアロジックを格納するパッケージです。ドキュメントの処理、埋め込みベクトル生成、ベクトルデータベースとの連携を担当します。

## 現状

-   初期のディレクトリ構造が作成されました。
-   各コンポーネントの実装はこれから行います。

## 関連コンポーネント

-   `mcp_server`: このパッケージが提供する機能を利用して、RAG機能をAPIとして公開します。
-   サブパッケージ:
    -   `document_processor`: ドキュメントの読み込みと分割を担当します。
    -   `embedding`: 埋め込みモデルを管理します。
    -   `vectordb`: ベクトルデータベース (DuckDB+VSS) との対話を行います。
    -   `cli`: ドキュメントをベクトルデータベースに登録するためのCLIツールを提供します。

## CLIツール (`rag-core-cli`)

### 目的

ローカルにあるドキュメントファイル（`.txt`, `.md`）を読み込み、チャンク分割、ベクトル化を行い、DuckDBベースのベクトルデータベースに登録するためのコマンドラインインターフェースです。

### 使い方

プロジェクトルートから `uv run` コマンドを使用して実行します。

**単一ファイルを処理する場合:**

```bash
uv run rag-core-cli --file path/to/your/document.txt
```

**ディレクトリ内の全ファイル（`.txt`, `.md`）を再帰的に処理する場合:**

```bash
uv run rag-core-cli --dir path/to/your/documents/
```

### オプション

-   `--file` / `-f`: 処理する単一のドキュメントファイルへのパスを指定します。`.txt` または `.md` 形式のみサポートされます。`--dir` と同時に指定することはできません。
-   `--dir` / `-d`: 処理するドキュメントが含まれるディレクトリへのパスを指定します。ディレクトリ内の `.txt` および `.md` ファイルが再帰的に処理されます。`--file` と同時に指定することはできません。

### 注意事項

-   このCLIツールを実行する前に、Ollamaサーバーがローカルで実行されており、`pyproject.toml` で指定された埋め込みモデル（デフォルト: `bge-m3`）が利用可能であることを確認してください。
    -   例: `ollama run bge-m3` を実行してモデルをダウンロード・起動します。
-   ベクトルデータはプロジェクトルートの `vector_store.db` ファイルに保存されます。

## 関連ドキュメント

-   [ADR 001: RAG実装の技術選定](../../docs/ADR/001-RAG実装の技術選定.md)
