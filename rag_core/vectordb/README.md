# Vector Database (`rag_core.vectordb`)

## 目的

埋め込みベクトルと関連メタデータの保存、および類似ベクトル検索を担当します。ベクトルデータベースとして DuckDB と VSS (Vector Similarity Search) 拡張機能を利用します。

## 現状

-   `storage.py` に `DuckDBVectorStore` クラスが実装されました。
-   このクラスは DuckDB への接続、VSS拡張のロード、テーブル作成、ベクトルデータの挿入・検索処理を提供します。

## 動作確認

`storage.py` ファイルを直接実行することで、基本的な動作を確認できます。

```bash
# プロジェクトルートディレクトリから実行
python3 rag_core/vectordb/storage.py
```

これにより、以下の処理が実行されます。

1.  `test_vector_store.db` という名前で DuckDB データベースファイルが作成されます。
2.  `test_embeddings` という名前でテーブルが作成されます。
3.  3つのダミーテキストとランダムなベクトルがデータベースに追加されます。
4.  ランダムなクエリベクトルで類似検索が実行され、結果（上位2件）がコンソールに出力されます。
5.  データベース接続が閉じられます。

**注意:** 実行後、`test_vector_store.db` ファイルがカレントディレクトリ（プロジェクトルート）に残ります。不要であれば手動で削除してください (`storage.py` 内の削除コードはコメントアウトされています)。

## 関連コンポーネント

-   `rag_core`: このパッケージの親パッケージ。
-   `rag_core.document_processor`: 処理されたドキュメントのメタデータを保存するために連携します。
-   `rag_core.embedding`: 生成された埋め込みベクトルを保存するために連携します。
-   `mcp_server`: ユーザーからのクエリに基づいて類似ベクトルを検索する際に利用されます。

## 関連ドキュメント

-   [ADR 001: RAG実装の技術選定](../../../docs/ADR/001-RAG実装の技術選定.md) (DuckDB+VSSの選定理由)
